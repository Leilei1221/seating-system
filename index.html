{
  `content`: `<!DOCTYPE html>
<html lang=\"zh-TW\">
<head>
    <meta charset=\"UTF-8\">
    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">
    <title>æœŸåˆåº§ä½è¨­å®šç³»çµ±</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Microsoft JhengHei', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); overflow: hidden; }
        .header { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 30px; text-align: center; }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .header p { font-size: 1.2em; opacity: 0.9; }
        .admin-panel { padding: 30px; border-bottom: 2px solid #eee; background: #f8f9fa; }
        .admin-controls { display: flex; gap: 20px; align-items: center; flex-wrap: wrap; justify-content: center; }
        .form-group { display: flex; flex-direction: column; gap: 5px; }
        .form-group label { font-weight: bold; color: #2c3e50; }
        .form-group select, .form-group input { padding: 12px 15px; border: 2px solid #ddd; border-radius: 10px; font-size: 16px; min-width: 150px; }
        .form-group select:focus, .form-group input:focus { outline: none; border-color: #4facfe; box-shadow: 0 0 10px rgba(79, 172, 254, 0.3); }
        .btn { padding: 12px 24px; border: none; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer; transition: all 0.3s ease; }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .btn-success { background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%); color: white; }
        .btn-info { background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); color: white; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.2); }
        .mode-switch { display: flex; gap: 10px; margin: 20px 0; justify-content: center; }
        .mode-btn { padding: 10px 20px; border: 2px solid #4facfe; background: white; color: #4facfe; border-radius: 25px; cursor: pointer; transition: all 0.3s ease; }
        .mode-btn.active { background: #4facfe; color: white; }
        .classroom-container { padding: 30px; }
        .blackboard { background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); color: white; text-align: center; padding: 20px; border-radius: 15px; margin-bottom: 40px; font-size: 28px; font-weight: bold; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .seating-area { display: flex; flex-direction: column; gap: 40px; }
        .row { display: flex; justify-content: center; gap: 30px; flex-wrap: wrap; }
        .group { background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 20px; padding: 25px; min-width: 200px; box-shadow: 0 8px 25px rgba(0,0,0,0.1); border: 3px solid transparent; transition: all 0.3s ease; }
        .group:hover { transform: translateY(-5px); border-color: #4facfe; box-shadow: 0 15px 35px rgba(0,0,0,0.2); }
        .group-title { text-align: center; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 12px 20px; border-radius: 15px; font-weight: bold; margin-bottom: 20px; font-size: 18px; }
        .seat { width: 100%; height: 60px; margin: 10px 0; border: 3px solid #ddd; border-radius: 12px; background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%); cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; font-weight: bold; position: relative; overflow: hidden; }
        .seat:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(0,0,0,0.15); border-color: #4facfe; }
        .seat.available { border-color: #27ae60; background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%); color: white; }
        .seat.occupied { border-color: #e74c3c; background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white; cursor: not-allowed; }
        .seat.selected { border-color: #f39c12; background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%); color: white; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(243, 156, 18, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(243, 156, 18, 0); } 100% { box-shadow: 0 0 0 0 rgba(243, 156, 18, 0); } }
        .seat-info { font-size: 14px; text-align: center; }
        .student-form { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .form-modal { background: white; padding: 40px; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); max-width: 500px; width: 90%; }
        .form-modal h3 { text-align: center; margin-bottom: 30px; color: #2c3e50; font-size: 24px; }
        .form-modal .form-group { margin-bottom: 20px; }
        .form-modal input { width: 100%; }
        .form-actions { display: flex; gap: 15px; justify-content: center; margin-top: 30px; }
        .summary-panel { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; margin: 30px; border-radius: 20px; text-align: center; }
        .summary-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; margin-top: 20px; }
        .stat-item { background: rgba(255,255,255,0.2); padding: 20px; border-radius: 15px; backdrop-filter: blur(10px); }
        .stat-number { font-size: 32px; font-weight: bold; display: block; }
        .qr-section { text-align: center; padding: 30px; background: #f8f9fa; margin: 30px; border-radius: 20px; }
        .qr-code { width: 200px; height: 200px; margin: 20px auto; background: white; border: 5px solid #4facfe; border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 18px; color: #666; }
        .legend { display: flex; justify-content: center; gap: 30px; margin: 30px 0; flex-wrap: wrap; }
        .legend-item { display: flex; align-items: center; gap: 10px; background: white; padding: 10px 20px; border-radius: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .legend-color { width: 20px; height: 20px; border-radius: 50%; }
        .add-student-btn { width: 100%; height: 35px; border: 2px dashed #3498db; background: transparent; color: #3498db; border-radius: 8px; cursor: pointer; font-size: 14px; margin-top: 5px; }
        .add-student-btn:hover { background: #3498db; color: white; }
        .sync-status { position: fixed; top: 20px; right: 20px; background: #f39c12; color: white; padding: 10px 15px; border-radius: 25px; font-size: 14px; z-index: 1001; }
        .sync-status.connected { background: #2ecc71; }
        .sync-status.disconnected { background: #e74c3c; }
        @media (max-width: 768px) { .admin-controls { flex-direction: column; align-items: stretch; } .row { flex-direction: column; align-items: center; } .group { min-width: 280px; } }
    </style>
</head>
<body>
    <div class=\"sync-status\" id=\"syncStatus\">âš ï¸ æœ¬åœ°æ¨¡å¼</div>
    
    <div class=\"container\">
        <div class=\"header\">
            <h1>ğŸ« æœŸåˆåº§ä½è¨­å®šç³»çµ±</h1>
            <p id=\"modeIndicator\">å­¸æœŸé–‹å§‹åº§ä½å®‰æ’ï¼Œä¸€æ¬¡è¨­å®šæ•´å­¸æœŸä½¿ç”¨</p>
        </div>

        <div class=\"admin-panel\">
            <div class=\"admin-controls\">
                <div class=\"form-group\">
                    <label>é¸æ“‡ç­ç´š</label>
                    <select id=\"classSelect\">
                        <option value=\"\">è«‹é¸æ“‡ç­ç´š</option>
                        <option value=\"301\">301</option>
                        <option value=\"302\">302</option>
                        <option value=\"303\">303</option>
                        <option value=\"304\">304</option>
                        <option value=\"305\">305</option>
                        <option value=\"306\">306</option>
                        <option value=\"307\">307</option>
                        <option value=\"308\">308</option>
                        <option value=\"309\">309</option>
                        <option value=\"310\">310</option>
                        <option value=\"311\">311</option>
                        <option value=\"312\">312</option>
                        <option value=\"multiple\">å¤šå…ƒé¸ä¿®</option>
                        <option value=\"advanced\">æ·±å»£èª²ç¨‹</option>
                    </select>
                </div>

                <div class=\"form-group\">
                    <label>å­¸æœŸ</label>
                    <select id=\"semesterSelect\">
                        <option value=\"2025-1\">2025å¹´ä¸Šå­¸æœŸ</option>
                        <option value=\"2025-2\">2025å¹´ä¸‹å­¸æœŸ</option>
                    </select>
                </div>

                <button class=\"btn btn-primary\" onclick=\"initializeClass()\">åˆå§‹åŒ–ç­ç´š</button>
                <button class=\"btn btn-success\" onclick=\"generateQR()\">ç”Ÿæˆå­¸ç”Ÿé€£çµ</button>
                <button class=\"btn btn-info\" onclick=\"exportToSheets()\">åŒ¯å‡ºè‡³Google Sheets</button>
            </div>

            <div class=\"mode-switch\">
                <div class=\"mode-btn active\" onclick=\"switchMode('teacher')\">ğŸ‘¨â€ğŸ« æ•™å¸«æ¨¡å¼</div>
                <div class=\"mode-btn\" onclick=\"switchMode('student')\">ğŸ‘¨â€ğŸ“ å­¸ç”Ÿæ¨¡å¼</div>
            </div>
        </div>

        <div class=\"classroom-container\">
            <div class=\"blackboard\">
                ğŸ–¤ é»‘æ¿ ğŸ“‹ <span id=\"classTitle\">è«‹å…ˆé¸æ“‡ç­ç´š</span>
            </div>

            <div class=\"legend\">
                <div class=\"legend-item\">
                    <div class=\"legend-color\" style=\"background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);\"></div>
                    <span>å¯é¸æ“‡</span>
                </div>
                <div class=\"legend-item\">
                    <div class=\"legend-color\" style=\"background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);\"></div>
                    <span>å·²é¸æ“‡</span>
                </div>
                <div class=\"legend-item\">
                    <div class=\"legend-color\" style=\"background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);\"></div>
                    <span>å·²è¢«é¸</span>
                </div>
            </div>

            <div class=\"seating-area\">
                <div class=\"row\">
                    <div class=\"group\"><div class=\"group-title\">ç¬¬1çµ„</div><div id=\"group1\"></div><button class=\"add-student-btn\" onclick=\"addStudent(1)\">+ æ–°å¢å­¸ç”Ÿ</button></div>
                    <div class=\"group\"><div class=\"group-title\">ç¬¬2çµ„</div><div id=\"group2\"></div><button class=\"add-student-btn\" onclick=\"addStudent(2)\">+ æ–°å¢å­¸ç”Ÿ</button></div>
                    <div class=\"group\"><div class=\"group-title\">ç¬¬3çµ„</div><div id=\"group3\"></div><button class=\"add-student-btn\" onclick=\"addStudent(3)\">+ æ–°å¢å­¸ç”Ÿ</button></div>
                </div>
                <div class=\"row\">
                    <div class=\"group\"><div class=\"group-title\">ç¬¬4çµ„</div><div id=\"group4\"></div><button class=\"add-student-btn\" onclick=\"addStudent(4)\">+ æ–°å¢å­¸ç”Ÿ</button></div>
                    <div class=\"group\"><div class=\"group-title\">ç¬¬5çµ„</div><div id=\"group5\"></div><button class=\"add-student-btn\" onclick=\"addStudent(5)\">+ æ–°å¢å­¸ç”Ÿ</button></div>
                    <div class=\"group\"><div class=\"group-title\">ç¬¬6çµ„</div><div id=\"group6\"></div><button class=\"add-student-btn\" onclick=\"addStudent(6)\">+ æ–°å¢å­¸ç”Ÿ</button></div>
                    <div class=\"group\"><div class=\"group-title\">ç¬¬7çµ„</div><div id=\"group7\"></div><button class=\"add-student-btn\" onclick=\"addStudent(7)\">+ æ–°å¢å­¸ç”Ÿ</button></div>
                </div>
            </div>
        </div>

        <div class=\"summary-panel\">
            <h3>ğŸ“Š åº§ä½å®‰æ’çµ±è¨ˆ</h3>
            <div class=\"summary-stats\">
                <div class=\"stat-item\"><span class=\"stat-number\" id=\"totalSeats\">35</span><span>ç¸½åº§ä½æ•¸</span></div>
                <div class=\"stat-item\"><span class=\"stat-number\" id=\"occupiedSeats\">0</span><span>å·²å®‰æ’</span></div>
                <div class=\"stat-item\"><span class=\"stat-number\" id=\"availableSeats\">35</span><span>å¯é¸æ“‡</span></div>
                <div class=\"stat-item\"><span class=\"stat-number\" id=\"completionRate\">0%</span><span>å®Œæˆç‡</span></div>
            </div>
        </div>

        <div class=\"qr-section\" id=\"qrSection\" style=\"display: none;\">
            <h3>ğŸ“± å­¸ç”Ÿé¸åº§é€£çµ</h3>
            <p>å°‡æ­¤é€£çµåˆ†äº«çµ¦å­¸ç”Ÿï¼Œè®“ä»–å€‘è‡ªè¡Œé¸æ“‡åº§ä½</p>
            <div class=\"qr-code\" id=\"qrCode\">QR Code å°‡åœ¨æ­¤é¡¯ç¤º</div>
            <p><strong>é€£çµ:</strong> <span id=\"studentLink\">å°šæœªç”Ÿæˆ</span></p>
            <button class=\"btn btn-info\" onclick=\"copyLink()\">ğŸ“‹ è¤‡è£½é€£çµ</button>
        </div>
    </div>

    <div class=\"student-form\" id=\"studentForm\">
        <div class=\"form-modal\">
            <h3>âœï¸ åº§ä½è³‡æ–™å¡«å¯«</h3>
            <div class=\"form-group\"><label>åº§è™Ÿ</label><input type=\"text\" id=\"studentId\" placeholder=\"è«‹è¼¸å…¥åº§è™Ÿ (ä¾‹å¦‚: 01)\"></div>
            <div class=\"form-group\"><label>å§“å</label><input type=\"text\" id=\"studentName\" placeholder=\"è«‹è¼¸å…¥å§“å\"></div>
            <div class=\"form-actions\">
                <button class=\"btn btn-success\" onclick=\"confirmSeat()\">âœ… ç¢ºèªåº§ä½</button>
                <button class=\"btn\" onclick=\"cancelSelection()\" style=\"background: #95a5a6; color: white;\">âŒ å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <script>
        let currentMode = 'teacher', selectedClass = '', selectedSemester = '', selectedSeat = null;
        let studentsData = {1: [], 2: [], 3: [], 4: [], 5: [], 6: [], 7: []};
        let syncInterval;

        // å„²å­˜éµå‰ç¶´
        function getStorageKey() {
            return `seating_${selectedClass}_${selectedSemester}`;
        }

        document.addEventListener('DOMContentLoaded', function() {
            checkUrlParams();
            renderAllGroups(); 
            updateSummary();
            startAutoSync();
        });

        function startAutoSync() {
            // æ¯3ç§’æª¢æŸ¥ä¸€æ¬¡localStorageçš„è®Šæ›´
            syncInterval = setInterval(() => {
                if (selectedClass) {
                    loadFromLocalStorage();
                }
            }, 3000);
        }

        function saveToLocalStorage() {
            if (selectedClass) {
                const key = getStorageKey();
                localStorage.setItem(key, JSON.stringify({
                    studentsData,
                    lastUpdated: new Date().toISOString()
                }));
                document.getElementById('syncStatus').textContent = 'ğŸ’¾ å·²å„²å­˜';
                document.getElementById('syncStatus').className = 'sync-status connected';
            }
        }

        function loadFromLocalStorage() {
            if (selectedClass) {
                const key = getStorageKey();
                const saved = localStorage.getItem(key);
                if (saved) {
                    try {
                        const data = JSON.parse(saved);
                        const newData = data.studentsData || {1: [], 2: [], 3: [], 4: [], 5: [], 6: [], 7: []};
                        
                        // æª¢æŸ¥æ˜¯å¦æœ‰è®Šæ›´
                        if (JSON.stringify(newData) !== JSON.stringify(studentsData)) {
                            studentsData = newData;
                            renderAllGroups();
                            updateSummary();
                            document.getElementById('syncStatus').textContent = 'ğŸ”„ å·²åŒæ­¥';
                            document.getElementById('syncStatus').className = 'sync-status connected';
                        }
                    } catch (e) {
                        console.error('è¼‰å…¥è³‡æ–™å¤±æ•—:', e);
                    }
                }
            }
        }

        function renderAllGroups() {
            for (let groupNum = 1; groupNum <= 7; groupNum++) renderGroup(groupNum);
        }

        function renderGroup(groupNum) {
            const container = document.getElementById(`group${groupNum}`);
            container.innerHTML = '';
            studentsData[groupNum].forEach((student, index) => {
                const seatDiv = document.createElement('div');
                seatDiv.className = `seat occupied`;
                seatDiv.innerHTML = `<div class=\"seat-info\"><div>${student.studentId} ${student.name}</div><div style=\"font-size: 12px; opacity: 0.8;\">å·²å®‰æ’</div></div>`;
                container.appendChild(seatDiv);
            });
            const currentCount = studentsData[groupNum].length;
            for (let i = currentCount; i < 5; i++) {
                const emptySeat = document.createElement('div');
                emptySeat.className = 'seat available';
                emptySeat.innerHTML = `<div class=\"seat-info\"><div>åº§ä½ ${i+1}</div><div style=\"font-size: 12px; opacity: 0.8;\">${currentMode === 'student' ? 'é»æ“Šé¸æ“‡' : 'ç©ºåº§ä½'}</div></div>`;
                if (currentMode === 'student') emptySeat.onclick = () => selectSeat(groupNum, i+1);
                container.appendChild(emptySeat);
            }
        }

        function switchMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            if (mode === 'student') {
                document.getElementById('modeIndicator').textContent = 'ğŸ‘¨â€ğŸ“ å­¸ç”Ÿé¸åº§æ¨¡å¼ - è«‹é»æ“Šç©ºåº§ä½é€²è¡Œé¸æ“‡';
                document.getElementById('modeIndicator').style.background = '#2ecc71';
                document.getElementById('modeIndicator').style.color = 'white';
                document.getElementById('modeIndicator').style.padding = '10px';
                document.getElementById('modeIndicator').style.borderRadius = '10px';
            } else {
                document.getElementById('modeIndicator').textContent = 'ğŸ‘¨â€ğŸ« æ•™å¸«ç®¡ç†æ¨¡å¼ - æŸ¥çœ‹åº§ä½å®‰æ’ç‹€æ³';
                document.getElementById('modeIndicator').style.background = '#3498db';
                document.getElementById('modeIndicator').style.color = 'white';
                document.getElementById('modeIndicator').style.padding = '10px';
                document.getElementById('modeIndicator').style.borderRadius = '10px';
            }
            
            renderAllGroups();
        }

        function initializeClass() {
            selectedClass = document.getElementById('classSelect').value;
            selectedSemester = document.getElementById('semesterSelect').value;
            if (!selectedClass) { alert('è«‹å…ˆé¸æ“‡ç­ç´šï¼'); return; }
            
            const classText = document.getElementById('classSelect').options[document.getElementById('classSelect').selectedIndex].text;
            document.getElementById('classTitle').textContent = classText;
            
            // è¼‰å…¥å·²å„²å­˜çš„è³‡æ–™
            loadFromLocalStorage();
            
            renderAllGroups(); 
            updateSummary();
            alert(`âœ… ${classText} åˆå§‹åŒ–å®Œæˆï¼`);
        }

        function selectSeat(groupNum, seatNum) {
            if (!selectedClass) { alert('è«‹å…ˆé¸æ“‡ä¸¦åˆå§‹åŒ–ç­ç´šï¼'); return; }
            if (currentMode !== 'student') { alert('è«‹åˆ‡æ›åˆ°å­¸ç”Ÿæ¨¡å¼æ‰èƒ½é¸æ“‡åº§ä½ï¼'); return; }
            
            // æª¢æŸ¥åº§ä½æ˜¯å¦å·²è¢«å ç”¨
            if (studentsData[groupNum].length >= seatNum) {
                alert('æ­¤åº§ä½å·²è¢«å ç”¨ï¼è«‹é¸æ“‡å…¶ä»–åº§ä½ã€‚');
                return;
            }
            
            selectedSeat = { group: groupNum, seat: seatNum };
            document.getElementById('studentForm').style.display = 'flex';
        }

        function confirmSeat() {
            const studentId = document.getElementById('studentId').value.trim();
            const studentName = document.getElementById('studentName').value.trim();
            if (!studentId || !studentName) { alert('è«‹å¡«å¯«å®Œæ•´çš„åº§è™Ÿå’Œå§“åï¼'); return; }
            if (!selectedSeat) { alert('è«‹å…ˆé¸æ“‡åº§ä½ï¼'); return; }
            
            let existingStudent = null;
            Object.values(studentsData).forEach(group => {
                group.forEach(student => { if (student.studentId === studentId) existingStudent = student; });
            });
            if (existingStudent) { alert('æ­¤åº§è™Ÿå·²å­˜åœ¨ï¼è«‹æª¢æŸ¥åº§è™Ÿã€‚'); return; }
            
            studentsData[selectedSeat.group].push({
                studentId: studentId, name: studentName, group: selectedSeat.group, 
                seat: selectedSeat.seat, assignedDate: new Date().toISOString()
            });
            
            // å„²å­˜åˆ° localStorage
            saveToLocalStorage();
            
            document.getElementById('studentForm').style.display = 'none';
            document.getElementById('studentId').value = '';
            document.getElementById('studentName').value = '';
            
            const confirmGroup = selectedSeat.group;
            selectedSeat = null;
            
            renderAllGroups(); 
            updateSummary();
            alert(`âœ… åº§ä½å®‰æ’æˆåŠŸï¼\
${studentId} ${studentName} -> ç¬¬${confirmGroup}çµ„\
\
æ‚¨çš„åº§ä½å·²ç¢ºèªï¼Œæ„Ÿè¬é…åˆï¼`);
        }

        function cancelSelection() {
            document.getElementById('studentForm').style.display = 'none';
            document.getElementById('studentId').value = '';
            document.getElementById('studentName').value = '';
            selectedSeat = null;
        }

        function addStudent(groupNum) {
            if (currentMode !== 'teacher') { alert('è«‹åˆ‡æ›åˆ°æ•™å¸«æ¨¡å¼æ‰èƒ½æ–°å¢å­¸ç”Ÿï¼'); return; }
            if (studentsData[groupNum].length >= 5) { alert('æ¯çµ„æœ€å¤šåªèƒ½æœ‰5ä½å­¸ç”Ÿï¼'); return; }
            
            const studentId = prompt('è«‹è¼¸å…¥å­¸ç”Ÿåº§è™Ÿï¼š');
            if (!studentId || !studentId.trim()) return;
            const studentName = prompt('è«‹è¼¸å…¥å­¸ç”Ÿå§“åï¼š');
            if (!studentName || !studentName.trim()) return;
            
            let existingStudent = null;
            Object.values(studentsData).forEach(group => {
                group.forEach(student => { if (student.studentId === studentId.trim()) existingStudent = student; });
            });
            if (existingStudent) { alert('æ­¤åº§è™Ÿå·²å­˜åœ¨ï¼è«‹æª¢æŸ¥åº§è™Ÿã€‚'); return; }
            
            studentsData[groupNum].push({
                studentId: studentId.trim(), name: studentName.trim(), group: groupNum,
                seat: studentsData[groupNum].length + 1, assignedDate: new Date().toISOString()
            });
            
            saveToLocalStorage();
            renderGroup(groupNum); updateSummary();
            alert(`âœ… å­¸ç”Ÿæ–°å¢æˆåŠŸï¼\
${studentId.trim()} ${studentName.trim()} -> ç¬¬${groupNum}çµ„`);
        }

        function updateSummary() {
            const totalSeats = 35;
            let occupiedSeats = 0;
            Object.values(studentsData).forEach(group => { occupiedSeats += group.length; });
            const availableSeats = totalSeats - occupiedSeats;
            const completionRate = Math.round((occupiedSeats / totalSeats) * 100);
            
            document.getElementById('totalSeats').textContent = totalSeats;
            document.getElementById('occupiedSeats').textContent = occupiedSeats;
            document.getElementById('availableSeats').textContent = availableSeats;
            document.getElementById('completionRate').textContent = `${completionRate}%`;
        }

        function generateQR() {
            if (!selectedClass) { alert('è«‹å…ˆé¸æ“‡ä¸¦åˆå§‹åŒ–ç­ç´šï¼'); return; }
            
            // ç¢ºä¿URLåŒ…å«å®Œæ•´è·¯å¾‘å’Œåƒæ•¸
            const baseUrl = window.location.origin + window.location.pathname;
            const studentUrl = `${baseUrl}?class=${selectedClass}&mode=student`;
            
            document.getElementById('studentLink').textContent = studentUrl;
            document.getElementById('qrCode').innerHTML = `
                <div>ğŸ“± å­¸ç”Ÿæƒæå¾Œ</div>
                <div>è‡ªå‹•é€²å…¥é¸åº§æ¨¡å¼</div>
                <div style=\"font-size: 12px; margin-top: 10px;\">ç­ç´š: ${selectedClass}</div>
            `;
            document.getElementById('qrSection').style.display = 'block';
            
            alert(`âœ… å­¸ç”Ÿé¸åº§é€£çµå·²ç”Ÿæˆï¼\
\
é€£çµ: ${studentUrl}\
\
è«‹å°‡æ­¤é€£çµè£½ä½œæˆQR Codeçµ¦å­¸ç”Ÿæƒæï¼Œæˆ–ç›´æ¥åˆ†äº«é€£çµã€‚\
\
å»ºè­°ä½¿ç”¨ qr-code-generator.com è£½ä½œQR Code`);
        }

        function copyLink() {
            const link = document.getElementById('studentLink').textContent;
            navigator.clipboard.writeText(link).then(() => { alert('ğŸ“‹ é€£çµå·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼'); });
        }

        function exportToSheets() {
            if (!selectedClass || Object.values(studentsData).every(group => group.length === 0)) {
                alert('æ²’æœ‰è³‡æ–™å¯åŒ¯å‡ºï¼è«‹å…ˆå®Œæˆåº§ä½å®‰æ’ã€‚'); return;
            }
            const exportData = {
                className: document.getElementById('classSelect').options[document.getElementById('classSelect').selectedIndex].text,
                semester: selectedSemester, students: [], seatingChart: studentsData, exportDate: new Date().toISOString()
            };
            Object.values(studentsData).forEach(group => {
                group.forEach(student => {
                    exportData.students.push({ åº§è™Ÿ: student.studentId, å§“å: student.name, åˆ†çµ„: student.group, åº§ä½: student.seat });
                });
            });
            console.log('åŒ¯å‡ºåˆ° Google Sheets:', exportData);
            alert(`âœ… è³‡æ–™å·²æº–å‚™åŒ¯å‡ºåˆ° Google Sheetsï¼\
ç­ç´š: ${exportData.className}\
å­¸ç”Ÿæ•¸: ${exportData.students.length}\
\
(å¯¦éš›ä½¿ç”¨æ™‚æœƒè‡ªå‹•ç™¼é€åˆ° n8n å»ºç«‹è©¦ç®—è¡¨)`);
        }

        function checkUrlParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const classParam = urlParams.get('class');
            const modeParam = urlParams.get('mode');
            
            if (classParam && modeParam === 'student') {
                selectedClass = classParam;
                document.getElementById('classSelect').value = classParam;
                
                // è‡ªå‹•åˆå§‹åŒ–ç­ç´š
                selectedSemester = document.getElementById('semesterSelect').value;
                const classText = document.getElementById('classSelect').options[document.getElementById('classSelect').selectedIndex].text;
                document.getElementById('classTitle').textContent = classText;
                
                // è¼‰å…¥è³‡æ–™
                loadFromLocalStorage();
                
                // è‡ªå‹•åˆ‡æ›åˆ°å­¸ç”Ÿæ¨¡å¼
                setTimeout(() => {
                    currentMode = 'student';
                    document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
                    document.querySelectorAll('.mode-btn')[`
}
